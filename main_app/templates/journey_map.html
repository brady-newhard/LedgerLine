{% extends 'base.html' %}
{% load ansi_shadow_tags %}

{% block content %}
<div class="terminal-container">
    <div class="terminal-header">
        {% ansi_shadow "FINANCIAL JOURNEY MAP" %}
    </div>
    
    <div class="terminal-body">
        <div class="journey-map-container">
            {% if user_modes %}
                <div class="journey-timeline">
                    {% for mode in user_modes %}
                        {% if mode.unlocked %}
                        <a href="{% url 'mode_dashboard' mode.name %}" class="journey-node-link">
                        {% endif %}
                        <div class="journey-node {% if mode.unlocked %}unlocked{% else %}locked{% endif %}" 
                             {% if not mode.unlocked %}
                             onclick="showLockMessage('{{ mode.name }}')"
                             {% endif %}>
                            <div class="mode-icon">{{ mode.icon|default:"ðŸ’°" }}</div>
                            <div class="mode-name">{{ mode.name }}</div>
                            <div class="mode-status">
                                {% if mode.unlocked %}
                                    <span class="status-unlocked">UNLOCKED</span>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: {{ mode.progress_percentage }}%;"></div>
                                    </div>
                                    <div class="progress-text">{{ mode.progress_percentage }}%</div>
                                {% else %}
                                    <span class="status-locked">LOCKED</span>
                                    {% if mode.progress_percentage > 0 %}
                                    <div class="progress-bar">
                                        <div class="progress-fill locked-progress" style="width: {{ mode.progress_percentage }}%;"></div>
                                    </div>
                                    <div class="progress-text">{{ mode.progress_percentage }}% towards unlocking</div>
                                    {% endif %}
                                {% endif %}
                            </div>
                            {% if mode.description %}
                                <div class="mode-description">{{ mode.description }}</div>
                            {% endif %}
                            {% if not mode.unlocked %}
                                <div class="lock-overlay">
                                    <div class="lock-icon">ðŸ”’</div>
                                </div>
                            {% endif %}
                        </div>
                        {% if mode.unlocked %}
                        </a>
                        {% endif %}
                        
                        {% if not forloop.last %}
                            <div class="journey-connector {% if mode.unlocked %}active{% endif %}"></div>
                        {% endif %}
                    {% endfor %}
                </div>
            {% else %}
                <div class="empty-journey">
                    <p>No financial modes available yet. Start your journey by unlocking your first mode!</p>
                </div>
            {% endif %}
        </div>
    </div>
    
    <div class="terminal-footer">
        <div class="footer-actions">
            <a href="{% url 'unlocked_modes' %}" class="terminal-button">View All Modes</a>
            <a href="{% url 'home' %}" class="terminal-button">Back to Dashboard</a>
        </div>
    </div>
    
    <div class="function-keys">
        <div class="function-key" onclick="showHelpInfo()">F1-Help</div>
        <div class="function-key" onclick="window.location.href='{% url 'home' %}'">F2-Home</div>
        <div class="function-key" onclick="window.location.href='{% url 'unlocked_modes' %}'">F3-Modes</div>
        <div class="function-key" onclick="window.location.href='{% url 'transaction_list' %}'">F4-Ledger</div>
    </div>
    
    <div class="status-bar">
        <span id="status-message">READY.</span>
        <span class="status-bar-brand">LEDGERLINE: Terminal Edition</span>
        <span>{% now "m/d/Y" %}</span>
    </div>

<script>
function showHelpInfo() {
  const helpText = `JOURNEY MAP HELP:
- This is your financial journey map showing all available modes
- Unlocked modes can be clicked to view detailed information
- Locked modes will become available as you continue your financial journey
- Continue using LEDGERLINE to unlock more modes
- Each mode represents different financial patterns and behaviors`;
  
  // Create terminal output if it doesn't exist
  if (!document.querySelector('.terminal-output')) {
    const terminalOutput = document.createElement('div');
    terminalOutput.className = 'terminal-output';
    document.querySelector('.terminal-container').insertBefore(
      terminalOutput, 
      document.querySelector('.terminal-body')
    );
  }
  
  // Find or create terminal output
  let output = document.querySelector('.terminal-output');
  
  // Update content
  output.innerHTML = helpText.replace(/\n/g, '<br>');
  
  // Update status
  document.getElementById('status-message').textContent = "Displaying help documentation";
}

function showLockMessage(modeName) {
  // Create terminal output if it doesn't exist
  if (!document.querySelector('.terminal-output')) {
    const terminalOutput = document.createElement('div');
    terminalOutput.className = 'terminal-output';
    document.querySelector('.terminal-container').insertBefore(
      terminalOutput, 
      document.querySelector('.terminal-body')
    );
  }
  
  // Find output element
  const output = document.querySelector('.terminal-output');
  
  // Create a randomly selected tantalizing message
  const messages = [
    `ACCESSING ${modeName.toUpperCase()}... ACCESS DENIED.\nThis mode is still locked. Continue using LEDGERLINE to unlock new insights about your financial behavior.`,
    `${modeName.toUpperCase()} MODE: LOCKED\nThis feature will be unlocked when your financial patterns meet specific criteria. Keep managing your finances with LEDGERLINE!`,
    `SYSTEM NOTIFICATION: ${modeName.toUpperCase()} is waiting to be discovered.\nYour financial journey will unlock this mode when the time is right.`,
    `${modeName.toUpperCase()} INITIALIZATION FAILED: MODE LOCKED\nImprove your financial habits to unlock this powerful mode.`
  ];
  
  const randomMessage = messages[Math.floor(Math.random() * messages.length)];
  
  // Add typing effect
  output.innerHTML = '';
  let i = 0;
  const speed = 30; // typing speed in ms
  
  function typeWriter() {
    if (i < randomMessage.length) {
      output.innerHTML += randomMessage.charAt(i) === '\n' ? '<br>' : randomMessage.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    } else {
      // Add blinking cursor at the end
      output.innerHTML += '<span class="blinking-cursor"></span>';
    }
  }
  
  typeWriter();
  
  // Update status
  document.getElementById('status-message').textContent = "ACCESS DENIED";
  
  // Shake the locked node slightly with animation
  const nodes = document.querySelectorAll('.journey-node.locked');
  nodes.forEach(node => {
    node.classList.add('shake');
    setTimeout(() => {
      node.classList.remove('shake');
    }, 500);
  });
}
</script>
</div>
{% endblock %}

{% block styles %}
<style>
    /* First update the locked nodes styling */
    .journey-node.locked {
        filter: grayscale(0.8);
        opacity: 0.7;
        cursor: pointer;
        transition: all 0.4s ease;
        overflow: hidden;
    }
    
    .journey-node.locked:hover {
        filter: grayscale(0.5);
        opacity: 0.85;
        border-color: #999;
        transform: translateY(-2px);
        box-shadow: 0 0 15px rgba(150, 150, 150, 0.3);
    }
    
    /* Add lock overlay styling */
    .lock-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        pointer-events: none;
    }
    
    .lock-icon {
        font-size: 2.5rem;
        opacity: 0.5;
        transition: all 0.3s ease;
        text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }
    
    .journey-node.locked:hover .lock-icon {
        transform: scale(1.2);
        opacity: 0.9;
    }
    
    /* Add styling for locked progress */
    .locked-progress {
        background-color: #777 !important;
        opacity: 0.6;
    }
    
    /* Add shake animation */
    @keyframes shake {
        0% { transform: translateX(0); }
        20% { transform: translateX(-5px); }
        40% { transform: translateX(5px); }
        60% { transform: translateX(-3px); }
        80% { transform: translateX(3px); }
        100% { transform: translateX(0); }
    }
    
    .shake {
        animation: shake 0.5s;
    }
    
    /* Keep existing styles below */
    .journey-map-container {
        padding: 20px;
    }
    
    .journey-timeline {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 20px 0;
    }
    
    .journey-node-link {
        text-decoration: none;
        display: block;
        width: 80%;
        max-width: 500px;
        cursor: pointer;
    }
    
    .journey-node {
        background-color: #111;
        border: 2px solid #333;
        border-radius: 8px;
        padding: 15px;
        width: 100%;
        margin: 10px 0;
        text-align: center;
        transition: all 0.3s ease;
        position: relative;
    }
    
    .journey-node.unlocked {
        border-color: #5f5;
        box-shadow: 0 0 10px rgba(95, 255, 95, 0.5);
    }
    
    .journey-node.unlocked:hover {
        transform: translateY(-3px);
        box-shadow: 0 0 15px rgba(95, 255, 95, 0.7);
    }

    /* Remaining existing styles */
    .journey-connector {
        height: 40px;
        width: 4px;
        background-color: #333;
    }
    
    .journey-connector.active {
        background-color: #5f5;
        box-shadow: 0 0 10px rgba(95, 255, 95, 0.5);
    }
    
    .mode-icon {
        font-size: 2em;
        margin-bottom: 10px;
    }
    
    .mode-name {
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 5px;
        text-transform: uppercase;
    }
    
    .mode-status {
        margin: 10px 0;
    }
    
    .status-unlocked {
        color: #5f5;
        font-weight: bold;
    }
    
    .status-locked {
        color: #f55;
        font-weight: bold;
    }
    
    .progress-bar {
        background-color: #222;
        height: 10px;
        border-radius: 5px;
        margin: 10px 0;
        overflow: hidden;
    }
    
    .progress-fill {
        background-color: #5f5;
        height: 100%;
        transition: width 0.5s ease-in-out;
    }
    
    .progress-text {
        font-size: 0.9em;
        color: #5f5;
    }
    
    .mode-description {
        margin-top: 10px;
        font-style: italic;
        color: #aaa;
    }
    
    .empty-journey {
        text-align: center;
        padding: 30px;
        color: #aaa;
    }
    
    .terminal-footer {
        margin-top: 20px;
        text-align: center;
    }
    
    .footer-actions {
        display: flex;
        justify-content: center;
        gap: 15px;
    }
    
    .terminal-button {
        background-color: #333;
        color: #fff;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        transition: all 0.2s ease;
    }
    
    .terminal-button:hover {
        background-color: #555;
        box-shadow: 0 0 8px rgba(255, 255, 255, 0.3);
    }
</style>
{% endblock %} 
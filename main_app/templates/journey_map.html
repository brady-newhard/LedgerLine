{% extends 'base.html' %}
{% load ansi_shadow_tags %}

{% block content %}
<div class="menu-bar">
  File  Edit  View  Format  Options  Range  Data  Help
</div>

<pre class="ascii-title">
<div class="ascii-terminal-style">{% ansi_shadow "FINANCIAL JOURNEY MAP" %}</div>
</pre>

<div class="terminal-output">
C:>ACCESS JOURNEY.DAT
Reading financial journey timeline...
Processing mode history...
Ready.
</div>

<div class="focus-text">
  <p>Your LEDGERLINE journey map tracks your financial evolution across different modes.</p>
  <p>Follow the timeline to see your progress and achievements.</p>
</div>

<div class="journey-timeline">
  {% for mode in mode_progression %}
    <div class="journey-node {% if mode.is_unlocked %}unlocked{% endif %}">
      <div class="journey-icon">{{ mode.icon }}</div>
      <div class="journey-mode-name">{{ mode.name }}</div>
      <div class="journey-progress">
        <div class="loading-bar">
          <div class="loading-bar-fill" style="width: {{ mode.progress }}%;"></div>
        </div>
        <span class="progress-text">{{ mode.progress }}%</span>
      </div>
      <div class="journey-description">{{ mode.description }}</div>
      <div class="journey-details">
        {% if mode.is_unlocked %}
          <span class="badge badge-success">UNLOCKED</span>
          <a href="{% url 'mode_dashboard' mode_name=mode.name %}" class="btn btn-small">Details</a>
        {% else %}
          <span class="badge">{{ mode.progress }}% PROGRESS</span>
          <div class="journey-notes text-muted">{{ mode.notes }}</div>
        {% endif %}
      </div>
    </div>
    
    {% if not forloop.last %}
      <div class="journey-connector"></div>
    {% endif %}
  {% endfor %}
</div>

<h3 class="section-header">Mode History</h3>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th class="col-label"></th>
        <th class="col-label">A</th>
        <th class="col-label">B</th>
        <th class="col-label">C</th>
        <th class="col-label">D</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="row-label">1</td>
        <td><strong>date</strong></td>
        <td><strong>mode</strong></td>
        <td><strong>event</strong></td>
        <td><strong>progress</strong></td>
      </tr>

      {% for mode_name, events in mode_history.items %}
        {% for event in events|slice:":5" %}
          <tr class="mode-row">
            <td class="row-label">{{ forloop.counter|add:"1" }}</td>
            <td>{{ event.timestamp|date:"m/d/Y H:i" }}</td>
            <td>{{ event.mode_name }}</td>
            <td>
              {% if event.status_change == 'unlocked' %}
                <span class="badge badge-success">UNLOCKED</span>
              {% elif event.status_change == 'locked' %}
                <span class="badge badge-warning">LOCKED</span>
              {% else %}
                <span class="badge">PROGRESS</span>
              {% endif %}
            </td>
            <td>{{ event.progress_percentage }}%</td>
          </tr>
        {% empty %}
          <tr>
            <td class="row-label">2</td>
            <td colspan="4">No history for {{ mode_name }} yet.</td>
          </tr>
        {% endfor %}
      {% empty %}
        <tr>
          <td class="row-label">2</td>
          <td colspan="4">No mode history found. Continue using LEDGERLINE to build your journey.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="function-keys">
  <div class="function-key" onclick="showHelpInfo()">F1-Help</div>
  <div class="function-key" onclick="window.location.reload()">F2-Refresh</div>
  <div class="function-key" onclick="window.location.href='{% url 'unlocked_modes' %}'">F3-Modes</div>
  <div class="function-key" onclick="window.location.href='{% url 'transaction_list' %}'">F4-Ledger</div>
</div>

<div class="status-bar">
  <span id="status-message">READY.</span>
  <span class="status-bar-brand">LEDGERLINE: Beige Edition</span>
  <span>{% now "m/d/Y" %}</span>
</div>

<style>
  .journey-timeline {
    display: flex;
    flex-direction: column;
    margin: 30px 0;
    align-items: flex-start;
  }
  
  .journey-node {
    background-color: var(--bg-secondary);
    border: 1px solid var(--border-color);
    padding: 15px;
    margin: 10px 0;
    width: 80%;
    position: relative;
    opacity: 0.7;
    transition: all 0.3s ease;
  }
  
  .journey-node.unlocked {
    opacity: 1;
    border: 1px solid var(--highlight-color);
    box-shadow: 0 0 5px rgba(var(--highlight-rgb), 0.3);
  }
  
  .journey-connector {
    width: 2px;
    height: 30px;
    background-color: var(--text-muted);
    margin-left: 20px;
  }
  
  .journey-icon {
    font-size: 2rem;
    float: left;
    margin-right: 15px;
  }
  
  .journey-mode-name {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 5px;
  }
  
  .journey-description {
    margin-bottom: 10px;
  }
  
  .journey-progress {
    margin: 10px 0;
  }
  
  .journey-details {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
  }
  
  .journey-notes {
    font-size: 0.9rem;
    margin-top: 5px;
    width: 100%;
  }
  
  .section-header {
    margin-top: 30px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 5px;
  }
  
  /* Retro flashing cursor */
  .terminal-output::after {
    content: "_";
    animation: blink 1s step-end infinite;
  }
  
  @keyframes blink {
    50% {
      opacity: 0;
    }
  }
</style>

<script>
function showHelpInfo() {
  const helpText = `JOURNEY MAP HELP:
- The Journey Map displays your financial path through the LEDGERLINE modes
- Each node represents a financial mode you can unlock
- The progress bar shows how close you are to unlocking each mode
- Unlocked modes have a glowing border and full details
- The history section shows your mode achievements over time
- Click the DETAILS button on an unlocked mode to see more information`;
  
  // Find or create terminal output
  let output = document.querySelector('.terminal-output');
  
  // Update content
  output.innerHTML = helpText.replace(/\n/g, '<br>');
  
  // Update status
  document.getElementById('status-message').textContent = "Displaying help documentation";
}
</script>
{% endblock %} 
{% extends 'base.html' %}
{% load ansi_shadow_tags %}

{% block content %}
<div class="menu-bar">
  File  Edit  View  Format  Options  Range  Data  Help
</div>

<pre class="ascii-title">
<div class="ascii-terminal-style">{% ansi_shadow "PREMIUM MODES" %}</div>
</pre>

<div class="terminal-output">
C:>ACCESS PREMIUM.DAT
Reading mode configuration...
Mode status: {% if has_unlocked_modes %}{{ modes|length }} mode(s) unlocked{% else %}No modes unlocked{% endif %}
</div>

<div class="table-container">
  <table>
    <thead>
      <tr>
        <th class="col-label"></th>
        <th class="col-label">A</th>
        <th class="col-label">B</th>
        <th class="col-label">C</th>
        <th class="col-label">D</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="row-label">1</td>
        <td><strong>status</strong></td>
        <td><strong>icon</strong></td>
        <td><strong>mode name</strong></td>
        <td><strong>description</strong></td>
      </tr>

      {% if all_modes %}
        <!-- Show unlocked modes first -->
        {% for mode in modes %}
          <tr class="mode-row clickable" onclick="window.location.href='{% url 'mode_dashboard' mode.name %}'">
            <td class="row-label">{{ forloop.counter|add:"1" }}</td>
            <td><span class="badge badge-success">unlocked</span></td>
            <td class="mode-icon">{{ mode.icon }}</td>
            <td><strong>{{ mode.name }}</strong></td>
            <td class="text-muted">{{ mode.description }}</td>
          </tr>
        {% endfor %}
        
        <!-- Then show locked modes -->
        {% for mode in locked_modes %}
          <tr class="mode-row locked-mode" onclick="showLockedModeHint('{{ mode.name }}', {{ mode.progress_percentage }})">
            <td class="row-label">{{ forloop.counter|add:modes|length|add:"1" }}</td>
            <td><span class="badge">locked</span></td>
            <td class="mode-icon">{{ mode.icon }}</td>
            <td><strong>{{ mode.name }}</strong></td>
            <td class="text-muted">{{ mode.description }}</td>
          </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td class="row-label">2</td>
          <td colspan="4">No modes initialized. Start using the app to unlock features!</td>
        </tr>
      {% endif %}
    </tbody>
  </table>
</div>

{% if not has_unlocked_modes %}
  <div class="alert" id="mode-alert">
    <p>System message: No modes unlocked yet.</p>
    <p class="text-muted">Continue using LEDGERLINE to unlock premium features.</p>
    <div class="loading-bar">
      <div class="loading-bar-fill" id="progress-bar" style="width: 15%;"></div>
    </div>
    <p class="text-muted" id="progress-text">Mode unlock progress: 15%</p>
  </div>
{% endif %}

<div class="mode-info focus-text">
  <h3>How Modes Work</h3>
  <p>LEDGERLINE tracks your financial behaviors and automatically unlocks special modes when specific conditions are met.</p>
  <ul>
    <li><strong>üîí Lockdown Mode</strong>: Triggered when expenses exceed income.</li>
    <li><strong>üèùÔ∏è Vacay Mode</strong>: Triggered by sustained savings over multiple months.</li>
    <li><strong>‚ö†Ô∏è Survival Mode</strong>: Triggered by intense early-month spending.</li>
    <li><strong>üèÜ Stability Mode</strong>: Triggered by consistent income/expense ratio over time.</li>
    <li><strong>üí∞ Saver Mode</strong>: Triggered when total savings exceed 3x monthly income.</li>
  </ul>
  <p>All modes are automatically tracked and unlocked based on your transaction history.</p>
</div>

<div class="function-keys">
  <div class="function-key" onclick="showHelpInfo()">F1-Help</div>
  <div class="function-key" onclick="window.location.reload()">F2-Refresh</div>
  <div class="function-key" onclick="window.location.href='/'">F3-Return</div>
  <div class="function-key" onclick="window.location.href='{% url 'transaction_list' %}'">F4-Ledger</div>
</div>

<div class="status-bar">
  <span id="status-message">READY.</span>
  <span class="status-bar-brand">LEDGERLINE: Beige Edition</span>
  <span>{% now "m/d/Y" %}</span>
</div>

<style>
  .mode-icon {
    font-size: 1.5rem;
    text-align: center;
  }
  .locked-mode {
    opacity: 0.7;
    transition: all 0.3s ease;
    cursor: pointer;
  }
  .locked-mode:hover {
    opacity: 0.85;
    background-color: #111 !important;
  }
  .clickable {
    cursor: pointer;
    transition: all 0.2s ease;
  }
  .clickable:hover {
    background-color: #111 !important;
    box-shadow: inset 0 0 5px rgba(0, 170, 0, 0.3);
  }
  
  @keyframes pulse {
    0% { background-color: #000000; }
    50% { background-color: #001a00; }
    100% { background-color: #000000; }
  }
  
  .pulsing {
    animation: pulse 2s infinite;
  }
</style>

<script>
function showHelpInfo() {
  const helpText = `PREMIUM MODES HELP:
- Modes are automatically unlocked based on your financial behavior
- Different modes track different aspects of your financial health
- Unlocked modes provide visual indicators of your financial patterns
- Check this page regularly to see your mode status
- The mode system is completely automatic - just use the app normally!`;
  
  // Find or create terminal output
  let output = document.querySelector('.terminal-output');
  
  // Update content
  output.innerHTML = helpText.replace(/\n/g, '<br>');
  
  // Update status
  document.getElementById('status-message').textContent = "Displaying help documentation";
}

function showLockedModeHint(modeName, progressPercentage) {
  // Find terminal output
  let output = document.querySelector('.terminal-output');
  
  // Get a hint message based on progress percentage
  let hintMessage = '';
  
  if (progressPercentage >= 75) {
    hintMessage = `SYSTEM NOTIFICATION: ${modeName.toUpperCase()} is nearly unlocked!\nYour progress is at ${progressPercentage}%. Continue your current financial patterns to unlock this mode very soon.`;
  } else if (progressPercentage >= 50) {
    hintMessage = `${modeName.toUpperCase()} MODE: HALFWAY THERE\nYou've made significant progress (${progressPercentage}%) towards unlocking this mode. Keep going!`;
  } else if (progressPercentage >= 25) {
    hintMessage = `LOADING ${modeName.toUpperCase()}... PROGRESS: ${progressPercentage}%\nYou're on the right track. Continue your financial journey to unlock this premium feature.`;
  } else {
    hintMessage = `${modeName.toUpperCase()} MODE: LOCKED (${progressPercentage}% PROGRESS)\nThis mode will track special aspects of your financial behavior. Continue using LEDGERLINE to make progress.`;
  }
  
  // Add typing effect
  output.innerHTML = '';
  let i = 0;
  const speed = 30; // typing speed in ms
  
  function typeWriter() {
    if (i < hintMessage.length) {
      output.innerHTML += hintMessage.charAt(i) === '\n' ? '<br>' : hintMessage.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    } else {
      // Add blinking cursor at the end
      output.innerHTML += '<span class="blinking-cursor"></span>';
    }
  }
  
  typeWriter();
  
  // Update progress bar animation for visual effect
  const progressBar = document.getElementById('progress-bar');
  const progressText = document.getElementById('progress-text');
  
  if (progressBar && progressText) {
    // Animate progress bar to the mode's progress percentage
    progressBar.style.width = '0%';
    progressBar.style.transition = 'width 1.5s ease-in-out';
    
    setTimeout(() => {
      progressBar.style.width = progressPercentage + '%';
      progressText.textContent = `Mode unlock progress: ${progressPercentage}%`;
    }, 100);
  }
  
  // Update status
  document.getElementById('status-message').textContent = `${modeName.toUpperCase()}: ANALYZING PROGRESS`;
  
  // Add pulse effect to the clicked row
  document.querySelectorAll('.mode-row.locked-mode').forEach(row => {
    row.classList.remove('pulsing');
  });
  
  const clickedRow = event.currentTarget;
  clickedRow.classList.add('pulsing');
}
</script>
{% endblock %}
